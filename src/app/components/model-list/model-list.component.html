<div class="p-4 space-y-4">
  <!-- Page Header -->
  <div class="card">
    <div class="flex justify-between items-start px-6 py-4">
      <div>
        <h1 class="text-2xl font-semibold text-gray-900 dark:text-gray-100">
          {{ recordDisplayMap[category()] || category() }}
        </h1>
        <div class="text-xs text-gray-400 dark:text-gray-500 font-mono mt-0.5">
          MODEL_REFERENCE_CATEGORY: {{ category() }}
        </div>
        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">
          {{ totalModels() }} models
          @if (filteredModels().length !== totalModels()) {
            (showing {{ filteredModels().length }} after filters)
          }
        </p>

        <!-- Category Statistics -->
        @if (filteredModels().length > 0) {
          <div class="flex flex-wrap gap-3 mt-3">
            @for (statType of categoryStatsConfig(); track statType) {
              @if (statType === 'baseline' && baselineStats().length > 0) {
                <div
                  class="inline-flex flex-col gap-1.5 px-3 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors"
                  title="Click for detailed baseline breakdown"
                  tabindex="0"
                  role="button"
                  (click)="showBaselineDetails()"
                  (keydown)="
                    ($event.key === 'Enter' || $event.key === ' ') && showBaselineDetails()
                  "
                >
                  <span
                    class="text-xs font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wide"
                    >Baselines</span
                  >
                  <div class="flex flex-wrap gap-1.5">
                    @for (stat of baselineStats(); track stat.baseline) {
                      <span class="badge badge-info" [title]="getBaselineTooltip(stat.baseline)">
                        {{ getBaselineDisplayName(stat.baseline) }}: {{ stat.count }}
                      </span>
                    }
                  </div>
                </div>
              }
              @if (statType === 'tags' && tagStats() > 0) {
                <div
                  class="inline-flex px-3 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors"
                  title="Click to see all tags"
                  tabindex="0"
                  role="button"
                  (click)="showTagsDetails()"
                  (keydown)="($event.key === 'Enter' || $event.key === ' ') && showTagsDetails()"
                >
                  <span class="badge badge-secondary">
                    {{ tagStats() }} tag{{ tagStats() === 1 ? '' : 's' }}
                  </span>
                </div>
              }
              @if (statType === 'nsfw') {
                <div
                  class="inline-flex flex-col gap-1.5 px-3 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors"
                  role="button"
                  tabindex="0"
                  title="Click for content rating details"
                  (click)="showNsfwDetails()"
                  (keydown)="($event.key === 'Enter' || $event.key === ' ') && showNsfwDetails()"
                >
                  <span
                    class="text-xs font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wide"
                    >Content Rating</span
                  >
                  <div class="flex flex-wrap gap-1.5">
                    @if (nsfwStats().nsfw > 0) {
                      <span class="badge badge-warning"> NSFW: {{ nsfwStats().nsfw }} </span>
                    }
                    @if (nsfwStats().sfw > 0) {
                      <span class="badge badge-success"> SFW: {{ nsfwStats().sfw }} </span>
                    }
                    @if (nsfwStats().unknown > 0) {
                      <span class="badge badge-secondary">
                        Unknown: {{ nsfwStats().unknown }}
                      </span>
                    }
                  </div>
                </div>
              }
              @if (statType === 'size' && sizeStats() > 0) {
                <div
                  class="inline-flex px-3 py-2 ..."
                  role="button"
                  tabindex="0"
                  title="Click for disk size details"
                  (click)="showSizeDetails()"
                  (keydown)="($event.key === 'Enter' || $event.key === ' ') && showSizeDetails()"
                >
                  <span class="badge badge-info"> {{ formatSizeInGB(sizeStats()) }} GB total </span>
                </div>
              }
              @if (statType === 'parameters') {
                <div
                  class="inline-flex flex-col gap-1.5 px-3 py-2 ..."
                  role="button"
                  tabindex="0"
                  title="Click for detailed parameter breakdown"
                  (click)="showParametersDetails()"
                  (keydown)="
                    ($event.key === 'Enter' || $event.key === ' ') && showParametersDetails()
                  "
                >
                  <span
                    class="text-xs font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wide"
                    >Parameters</span
                  >
                  <div class="flex flex-wrap gap-1.5">
                    @for (bucket of parameterBucketStats().topBuckets; track bucket.params) {
                      <span class="badge badge-info">
                        {{ bucket.count }}x ({{ formatParametersInBillions(bucket.params) }})
                      </span>
                    }
                    @if (parameterBucketStats().otherCount > 0) {
                      <span class="badge badge-secondary">
                        {{ parameterBucketStats().otherCount }} other{{
                          parameterBucketStats().otherCount === 1 ? '' : 's'
                        }}
                      </span>
                    }
                  </div>
                </div>
              }
              @if (statType === 'requirements' && requirementsStats() > 0) {
                <div
                  class="inline-flex px-3 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors"
                  title="Click to see model requirements"
                  tabindex="0"
                  role="button"
                  (click)="showRequirementsDetails()"
                  (keydown)="
                    ($event.key === 'Enter' || $event.key === ' ') && showRequirementsDetails()
                  "
                >
                  <span class="badge badge-info">
                    {{ requirementsStats() }} model{{
                      requirementsStats() === 1 ? '' : 's'
                    }}
                    with requirements
                  </span>
                </div>
              }
            }
          </div>
        }

        @if (writable()) {
          <button class="btn btn-primary mt-2" (click)="createModel()">+ Create Model</button>
        }
      </div>
    </div>
  </div>

  <!-- Search and Toggle -->
  <div
    class="sticky top-0 z-40 flex gap-4 items-end bg-gray-50 dark:bg-gray-900 pt-2 pb-4 -mx-4 px-4 shadow-md before:absolute before:inset-x-0 before:bottom-full before:h-4 before:bg-gray-50 dark:before:bg-gray-900"
  >
    <div>
      <label for="model-search" class="form-label">Search models</label>
      <input
        id="model-search"
        type="search"
        class="form-input w-64 text-gray-400"
        placeholder="Enter a name, description, or tag"
        [(ngModel)]="searchTerm"
        (ngModelChange)="searchTerm.set($event)"
      />
    </div>
    <div class="relative">
      <label class="form-label" for="tag-filter-btn">Filter by tags</label>
      <button
        id="tag-filter-btn"
        type="button"
        class="form-input w-64 text-left flex items-center justify-between"
        (click)="toggleTagFilterDropdown()"
      >
        <span class="truncate">
          @if (selectedTags().length === 0) {
            All tags
          } @else {
            {{ selectedTags().length }} tag(s) selected
          }
        </span>
        <svg
          class="w-4 h-4 ml-2 flex-shrink-0"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M19 9l-7 7-7-7"
          ></path>
        </svg>
      </button>

      @if (tagFilterOpen()) {
        <!-- Backdrop to close dropdown when clicking outside -->
        <div
          class="fixed inset-0 z-40"
          tabindex="0"
          (click)="closeTagFilterDropdown()"
          (keydown)="($event.key === 'Enter' || $event.key === ' ') && closeTagFilterDropdown()"
          aria-label="Close tag filter dropdown"
        ></div>

        <div
          class="absolute z-50 mt-1 w-64 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg max-h-64 overflow-y-auto"
        >
          <div
            class="p-2 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center"
          >
            <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Select tags</span>
            @if (selectedTags().length > 0) {
              <button type="button" class="text-xs link" (click)="clearAllTags()">Clear all</button>
            }
          </div>
          <div class="p-2">
            @if (availableTags().length === 0) {
              <div class="text-sm text-gray-500 dark:text-gray-400 text-center py-2">
                No tags available
              </div>
            } @else {
              @for (tag of availableTags(); track tag) {
                <label
                  class="flex items-center px-2 py-1.5 hover:bg-gray-100 dark:hover:bg-gray-700 rounded cursor-pointer"
                >
                  <input
                    type="checkbox"
                    class="w-4 h-4 text-primary-600 border-gray-300 dark:border-gray-600 rounded focus:ring-primary-500"
                    [checked]="isTagSelected(tag)"
                    (change)="toggleTag(tag)"
                  />
                  <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">{{ tag }}</span>
                </label>
              }
            }
          </div>
        </div>
      }
    </div>
    <label class="flex items-center gap-2 cursor-pointer select-none">
      <input
        type="checkbox"
        class="sr-only peer"
        [checked]="showDetails()"
        (change)="showDetails.set(!showDetails())"
        aria-checked="{{ showDetails() ? 'true' : 'false' }}"
        role="switch"
      />
      <span
        class="w-11 h-6 bg-gray-300 dark:bg-gray-700 rounded-full relative transition-colors duration-200 peer-checked:bg-primary-600 dark:peer-checked:bg-primary-400"
      >
        <span
          class="absolute top-1 left-1 w-4 h-4 bg-white dark:bg-gray-900 rounded-full shadow transition-transform duration-200"
          [class.translate-x-5]="showDetails()"
        ></span>
      </span>
      <span class="text-sm font-medium text-gray-700 dark:text-gray-200">
        {{ showDetails() ? 'Hide Details' : 'Show Details' }}
      </span>
    </label>
  </div>

  <!-- Loading/Empty States -->
  @if (loading()) {
    <div class="card">
      <div class="text-center py-12 text-gray-500 dark:text-gray-400">Loading models...</div>
    </div>
  } @else if (filteredModels().length === 0) {
    <div class="card">
      <div class="text-center py-12 text-gray-500 dark:text-gray-400">
        @if (searchTerm()) {
          No models match your search
        } @else {
          No models in this category
        }
      </div>
    </div>
  } @else {
    <!-- Data Table -->
    <div class="data-table">
      <table>
        @if (!showDetails()) {
          <!-- Fewer Details Mode -->
          <thead>
            <tr>
              <th class="w-8"></th>
              <th class="w-auto">Name</th>
              <th class="w-1/3">Description</th>
              <th>Baseline</th>
              <th>Tags</th>
              <th>NSFW</th>
              @if (writable()) {
                <th>Actions</th>
              }
            </tr>
          </thead>
          <tbody>
            @for (model of filteredModels(); track model.name; let isEven = $even) {
              <tr
                [class]="
                  'cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors ' +
                  (isEven ? 'bg-gray-50 dark:bg-gray-700/30' : 'bg-white dark:bg-gray-800')
                "
                (click)="toggleRowExpansion(model.name)"
              >
                <td class="text-center">
                  <svg
                    class="w-4 h-4 inline-block transition-transform duration-200"
                    [class.rotate-90]="isRowExpanded(model.name)"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M9 5l7 7-7 7"
                    ></path>
                  </svg>
                </td>
                <td class="font-medium text-gray-900 dark:text-gray-100">
                  <span class="flex items-center gap-2">
                    <span>{{ model.name }}</span>
                    @if (model.version) {
                      <span class="text-xs text-gray-400 dark:text-gray-400">{{ model.version }}</span>
                    }
                  </span>
                </td>
                <td class="text-gray-600 dark:text-gray-400 max-w-md truncate">
                  {{ model.description || '-' }}
                </td>
                <td>
                  @if (isStableDiffusionRecord(model)) {
                    {{ baselineDisplayMap[model.baseline] || model.baseline }}
                  } @else if (isTextGenerationRecord(model)) {
                    {{ model.baseline || '-' }}
                  } @else {
                    -
                  }
                </td>
                <td class="max-w-xs">
                  @if (isStableDiffusionRecord(model) && model.tags && model.tags.length > 0) {
                    <span class="text-sm text-gray-600 dark:text-gray-400">
                      {{ model.tags.slice(0, 3).join(', ') }}
                      @if (model.tags.length > 3) {
                        <span class="text-gray-400 italic ml-1">
                          +{{ model.tags.length - 3 }}
                        </span>
                      }
                    </span>
                  } @else if (
                    isTextGenerationRecord(model) && model.tags && model.tags.length > 0
                  ) {
                    <span class="text-sm text-gray-600 dark:text-gray-400">
                      {{ model.tags.slice(0, 3).join(', ') }}
                      @if (model.tags.length > 3) {
                        <span class="text-gray-400 italic ml-1">
                          +{{ model.tags.length - 3 }}
                        </span>
                      }
                    </span>
                  } @else {
                    -
                  }
                </td>
                <!-- Version is now shown in the Name column -->
                <td>
                  @if (model.nsfw) {
                    <span class="badge badge-warning">NSFW</span>
                  } @else if (model.nsfw === false) {
                    <span class="badge badge-success">SFW</span>
                  } @else {
                    <span class="badge badge-secondary">Unknown</span>
                  }
                </td>
                @if (writable()) {
                  <td>
                    <div class="flex gap-2 whitespace-nowrap">
                      <button
                        class="btn btn-sm btn-secondary"
                        (click)="showJson(model); $event.stopPropagation()"
                      >
                        Json
                      </button>
                      <button
                        class="btn btn-sm btn-primary"
                        (click)="editModel(model.name); $event.stopPropagation()"
                      >
                        Edit
                      </button>
                      <button
                        class="btn btn-sm btn-danger"
                        (click)="confirmDelete(model.name); $event.stopPropagation()"
                      >
                        Delete
                      </button>
                    </div>
                  </td>
                }
              </tr>
              <!-- Expanded Details Row -->
              @if (isRowExpanded(model.name)) {
                <tr
                  [class]="isEven ? 'bg-gray-50 dark:bg-gray-700/30' : 'bg-white dark:bg-gray-800'"
                >
                  <td [attr.colspan]="writable() ? 9 : 8" class="py-4 px-6">
                    <div class="space-y-4">
                      <!-- Detailed Fields - Stable Diffusion -->
                      @if (isStableDiffusionRecord(model)) {
                        <div class="grid grid-cols-4 gap-x-6 gap-y-3 text-sm">
                          <!-- Core Model Info -->
                          <div>
                            <div class="field-label">Baseline</div>
                            <div class="field-value">
                              {{ model.baseline }}
                              @if (model.optimization && model.optimization.trim() !== '') {
                                <span class="text-gray-500"> ({{ model.optimization }})</span>
                              }
                            </div>
                          </div>
                          <div>
                            <div class="field-label">Version</div>
                            <div class="field-value">{{ model.version || '-' }}</div>
                          </div>
                          <div>
                            <div class="field-label">Style</div>
                            <div class="field-value">{{ model.style || '-' }}</div>
                          </div>

                          <!-- Technical Details -->
                          <div>
                            <div class="field-label">Size</div>
                            <div class="field-value">
                              {{
                                model.size_on_disk_bytes
                                  ? (model.size_on_disk_bytes / 1024 / 1024 / 1024).toFixed(2) +
                                    ' GB'
                                  : '-'
                              }}
                            </div>
                          </div>

                          <!-- Requirements Details (if present) -->
                          @if (model.requirements && getObjectKeysLength(model.requirements) > 0) {
                            <div class="col-span-4">
                              <div class="field-label">Requirements Details</div>
                              <div class="text-sm bg-gray-50 dark:bg-gray-900 p-3 rounded border border-gray-200 dark:border-gray-700">
                                <pre class="whitespace-pre-wrap break-words text-gray-700 dark:text-gray-300 font-mono text-xs">{{ formatRequirements(model.requirements) }}</pre>
                              </div>
                            </div>
                          }

                          <!-- Showcases (if present) -->
                          @if (hasShowcases(model)) {
                            <div class="col-span-4">
                              <div class="flex items-center gap-2">                                
                                <button
                                  type="button"
                                  class="text-sm link flex items-center gap-1"
                                  (click)="toggleShowcases(model.name)"
                                >
                                  @if (areShowcasesExpanded(model.name)) {
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
                                    </svg>
                                    Hide Showcases
                                  } @else {
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                    Show Showcases
                                  }
                                </button>
                              </div>
                              @if (areShowcasesExpanded(model.name)) {
                                <div class="mt-2 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
                                  @for (showcase of model.showcases; track showcase; let idx = $index) {
                                    <div class="group relative aspect-square overflow-hidden rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-100 dark:bg-gray-800">
                                      <img
                                        [src]="showcase"
                                        [alt]="'Showcase ' + (idx + 1) + ' for ' + model.name"
                                        class="w-full h-full object-cover transition-transform duration-200 group-hover:scale-110"
                                        loading="lazy"
                                        (error)="onImageError($event)"
                                      />
                                      <a
                                        [href]="showcase"
                                        target="_blank"
                                        rel="noopener noreferrer"
                                        class="absolute inset-0 flex items-center justify-center bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity"
                                        [attr.aria-label]="'Open showcase ' + (idx + 1) + ' in new tab'"
                                      >
                                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                                        </svg>
                                      </a>
                                    </div>
                                  }
                                </div>
                              }
                            </div>
                          }

                          <!-- Links & Arrays (Full Width) -->
                          <div class="col-span-4">
                            <div class="field-label">Homepage</div>
                            <div class="text-gray-600 dark:text-gray-400 break-all">
                              @if (model.homepage) {
                                <a
                                  [href]="model.homepage"
                                  target="_blank"
                                  rel="noopener noreferrer"
                                  class="link"
                                >
                                  {{ model.homepage }}
                                </a>
                              } @else {
                                -
                              }
                            </div>
                          </div>

                          <div class="col-span-4">
                            <div class="field-label">Triggers</div>
                            <div class="field-value">
                              {{
                                model.trigger && model.trigger.length > 0
                                  ? model.trigger.join(', ')
                                  : '-'
                              }}
                            </div>
                          </div>

                          
                        </div>
                      }

                      <!-- Detailed Fields - Text Generation -->
                      @if (isTextGenerationRecord(model)) {
                        <div class="grid grid-cols-4 gap-x-6 gap-y-3 text-sm">
                          <!-- Row 1: Core Model Info -->
                          <div>
                            <div class="field-label">Baseline</div>
                            <div class="field-value">{{ model.baseline || '-' }}</div>
                          </div>
                          <div>
                            <div class="field-label">Version</div>
                            <div class="field-value">{{ model.version || '-' }}</div>
                          </div>
                          <div>
                            <div class="field-label">Parameters</div>
                            <div class="field-value">
                              {{ model.parameters ? model.parameters.toLocaleString() : '-' }}
                            </div>
                          </div>
                          <div>
                            <div class="field-label">Type</div>
                            <div class="field-value">{{ model.type || '-' }}</div>
                          </div>

                          <!-- Row 2: Names & Identifiers -->
                          <div>
                            <div class="field-label">Display Name</div>
                            <div class="field-value">{{ model.display_name || '-' }}</div>
                          </div>
                          <div>
                            <div class="field-label">Model Name</div>
                            <div class="field-value">{{ model.model_name || '-' }}</div>
                          </div>
                          <div>
                            <div class="field-label">Style</div>
                            <div class="field-value">{{ model.style || '-' }}</div>
                          </div>
                          <div>
                            <div class="field-label">Settings</div>
                            <div class="field-value">
                              {{
                                model.settings
                                  ? getObjectKeysLength(model.settings) + ' setting(s)'
                                  : '-'
                              }}
                            </div>
                          </div>

                          <!-- Row 3: Links & Arrays (Full Width) -->
                          <div class="col-span-4">
                            <div class="field-label">URL</div>
                            <div class="text-gray-600 dark:text-gray-400 break-all">
                              @if (model.url) {
                                <a
                                  [href]="model.url"
                                  target="_blank"
                                  rel="noopener noreferrer"
                                  class="link"
                                >
                                  {{ model.url }}
                                </a>
                              } @else {
                                -
                              }
                            </div>
                          </div>

                          <div class="col-span-4">
                            <div class="field-label">Features Not Supported</div>
                            <div class="field-value">
                              {{
                                model.features_not_supported &&
                                model.features_not_supported.length > 0
                                  ? model.features_not_supported.join(', ')
                                  : '-'
                              }}
                            </div>
                          </div>
                        </div>
                      }

                      <!-- Detailed Fields - CLIP -->
                      @if (isClipRecord(model)) {
                        <div class="grid grid-cols-4 gap-x-6 gap-y-3 text-sm">
                          <!-- Row 1: Core Model Info -->
                          <div>
                            <div class="field-label">Pretrained Name</div>
                            <div class="field-value">{{ model.pretrained_name || '-' }}</div>
                          </div>
                          <div>
                            <div class="field-label">Version</div>
                            <div class="field-value">{{ model.version || '-' }}</div>
                          </div>
                          <div>
                            <div class="field-label">Type</div>
                            <div class="field-value">{{ model.type || '-' }}</div>
                          </div>
                          <div>
                            <div class="field-label">Style</div>
                            <div class="field-value">{{ model.style || '-' }}</div>
                          </div>

                          <!-- Row 2: Arrays (Full Width) -->
                          <div class="col-span-4">
                            <div class="field-label">Features Not Supported</div>
                            <div class="field-value">
                              {{
                                model.features_not_supported &&
                                model.features_not_supported.length > 0
                                  ? model.features_not_supported.join(', ')
                                  : '-'
                              }}
                            </div>
                          </div>
                        </div>
                      }
                    </div>
                  </td>
                </tr>
              }
            }
          </tbody>
        } @else {
          <!-- Show Details Mode -->
          <thead>
            <tr>
              <th class="w-full">Model Details</th>
              @if (writable()) {
                <th class="w-auto">Actions</th>
              }
            </tr>
          </thead>
          <tbody>
            @for (model of filteredModels(); track model.name) {
              <tr class="align-top">
                <td class="py-4">
                  <div class="card p-5 space-y-4">
                    <!-- Header: name, version, description, tags -->
                    <div class="flex items-start justify-between gap-4">
                      <div class="min-w-0">
                        <div class="flex items-center gap-2 min-w-0">
                          <div class="font-semibold text-lg text-gray-900 dark:text-gray-100 truncate">
                            {{ model.name }}
                          </div>
                          @if (model.version) {
                            <span class="badge badge-secondary">v{{ model.version }}</span>
                          }
                        </div>
                        <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">
                          {{ model.description || 'No description' }}
                        </div>
                        <div class="flex flex-wrap gap-2 mt-2">
                          @if (isStableDiffusionRecord(model) && model.tags && model.tags.length > 0) {
                            @for (tag of model.tags; track tag) {
                              <span class="tag tag-primary">{{ tag }}</span>
                            }
                          } @else if (isTextGenerationRecord(model) && model.tags && model.tags.length > 0) {
                            @for (tag of model.tags; track tag) {
                              <span class="tag tag-primary">{{ tag }}</span>
                            }
                          }
                          @if (isStableDiffusionRecord(model) && model.inpainting) {
                            <span class="tag tag-success">Inpainting</span>
                          }
                        </div>
                      </div>
                      <div class="flex flex-col items-end gap-2 flex-shrink-0">
                        <div>
                          @if (model.nsfw) {
                            <span class="badge badge-warning">NSFW</span>
                          } @else if (model.nsfw === false) {
                            <span class="badge badge-success">Safe</span>
                          } @else {
                            <span class="badge badge-secondary">Unknown</span>
                          }
                        </div>
                        <div>
                          @if (getDownloadCount(model) > 0) {
                            <span class="badge badge-info">{{ getDownloadCount(model) }} files</span>
                          } @else {
                            <span class="badge badge-secondary">No files</span>
                          }
                        </div>
                      </div>
                    </div>

                    <!-- Quick facts row (badges) -->
                    @if (isStableDiffusionRecord(model)) {
                      <div class="flex flex-wrap gap-2">
                        <span class="badge badge-info">Baseline: {{ baselineDisplayMap[model.baseline] || model.baseline }}</span>
                        <span class="badge badge-secondary">Type: {{ model.type || '-' }}</span>
                        <span class="badge badge-secondary">Style: {{ model.style || '-' }}</span>
                        <span class="badge badge-secondary">Optimization: {{ model.optimization || '-' }}</span>
                        <span class="badge badge-secondary">Min Bridge: {{ model.min_bridge_version || '-' }}</span>
                        <span class="badge badge-secondary">
                          Size:
                          {{ model.size_on_disk_bytes ? (model.size_on_disk_bytes / 1024 / 1024 / 1024).toFixed(2) + ' GB' : '-' }}
                        </span>
                        <span class="badge badge-secondary">
                          Requirements:
                          {{ model.requirements ? getObjectKeysLength(model.requirements) : 0 }}
                        </span>
                      </div>

                      <div class="grid md:grid-cols-2 gap-4">
                        <div>
                          <div class="field-label">Homepage</div>
                          <div class="text-gray-600 dark:text-gray-400 break-all">
                            @if (model.homepage) {
                              <a [href]="model.homepage" target="_blank" rel="noopener noreferrer" class="link">
                                {{ model.homepage }}
                              </a>
                            } @else { - }
                          </div>
                        </div>
                        <div>
                          <div class="field-label">Triggers</div>
                          <div class="field-value">
                            {{ model.trigger && model.trigger.length > 0 ? model.trigger.join(', ') : '-' }}
                          </div>
                        </div>
                        <div class="md:col-span-2">
                          <div class="field-label">Features Not Supported</div>
                          <div class="field-value">
                            {{ model.features_not_supported && model.features_not_supported.length > 0 ? model.features_not_supported.join(', ') : '-' }}
                          </div>
                        </div>
                        @if (model.requirements && getObjectKeysLength(model.requirements) > 0) {
                          <div class="md:col-span-2">
                            <div class="field-label">Requirements</div>
                            <div class="text-sm bg-gray-50 dark:bg-gray-900 p-3 rounded border border-gray-200 dark:border-gray-700">
                              <pre class="whitespace-pre-wrap break-words text-gray-700 dark:text-gray-300 font-mono text-xs">{{ formatRequirements(model.requirements) }}</pre>
                            </div>
                          </div>
                        }
                        @if (hasShowcases(model)) {
                          <div class="md:col-span-2">
                            <div class="flex items-center justify-between">
                              <div class="field-label">
                                Showcases ({{ model.showcases!.length }})
                              </div>
                              <button
                                type="button"
                                class="text-sm link flex items-center gap-1"
                                (click)="toggleShowcases(model.name)"
                              >
                                @if (areShowcasesExpanded(model.name)) {
                                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
                                  </svg>
                                  Hide Images
                                } @else {
                                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                  </svg>
                                  Show Images
                                }
                              </button>
                            </div>
                            @if (areShowcasesExpanded(model.name)) {
                              <div class="mt-2 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
                                @for (showcase of model.showcases; track showcase; let idx = $index) {
                                  <div class="group relative aspect-square overflow-hidden rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-100 dark:bg-gray-800">
                                    <img
                                      [src]="showcase"
                                      [alt]="'Showcase ' + (idx + 1) + ' for ' + model.name"
                                      class="w-full h-full object-cover transition-transform duration-200 group-hover:scale-110"
                                      loading="lazy"
                                      (error)="onImageError($event)"
                                    />
                                    <a
                                      [href]="showcase"
                                      target="_blank"
                                      rel="noopener noreferrer"
                                      class="absolute inset-0 flex items-center justify-center bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity"
                                      [attr.aria-label]="'Open showcase ' + (idx + 1) + ' in new tab'"
                                    >
                                      <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                                      </svg>
                                    </a>
                                  </div>
                                }
                              </div>
                            }
                          </div>
                        }
                      </div>
                    }

                    @if (isTextGenerationRecord(model)) {
                      <div class="flex flex-wrap gap-2">
                        <span class="badge badge-info">Baseline: {{ model.baseline || '-' }}</span>
                        <span class="badge badge-secondary">Type: {{ model.type || '-' }}</span>
                        <span class="badge badge-secondary">Style: {{ model.style || '-' }}</span>
                        <span class="badge badge-secondary">
                          Parameters: {{ model.parameters ? model.parameters.toLocaleString() : '-' }}
                        </span>
                        <span class="badge badge-secondary">Settings: {{ model.settings ? getObjectKeysLength(model.settings) : 0 }}</span>
                      </div>

                      <div class="grid md:grid-cols-2 gap-4">
                        <div>
                          <div class="field-label">Display Name</div>
                          <div class="field-value">{{ model.display_name || '-' }}</div>
                        </div>
                        <div>
                          <div class="field-label">Model Name</div>
                          <div class="field-value">{{ model.model_name || '-' }}</div>
                        </div>
                        <div class="md:col-span-2">
                          <div class="field-label">URL</div>
                          <div class="text-gray-600 dark:text-gray-400 break-all">
                            @if (model.url) {
                              <a [href]="model.url" target="_blank" rel="noopener noreferrer" class="link">
                                {{ model.url }}
                              </a>
                            } @else { - }
                          </div>
                        </div>
                        <div class="md:col-span-2">
                          <div class="field-label">Features Not Supported</div>
                          <div class="field-value">
                            {{ model.features_not_supported && model.features_not_supported.length > 0 ? model.features_not_supported.join(', ') : '-' }}
                          </div>
                        </div>
                      </div>
                    }

                    @if (isClipRecord(model)) {
                      <div class="flex flex-wrap gap-2">
                        <span class="badge badge-info">Type: {{ model.type || '-' }}</span>
                        <span class="badge badge-secondary">Style: {{ model.style || '-' }}</span>
                        <span class="badge badge-secondary">Version: {{ model.version || '-' }}</span>
                      </div>

                      <div class="grid md:grid-cols-2 gap-4">
                        <div>
                          <div class="field-label">Pretrained Name</div>
                          <div class="field-value">{{ model.pretrained_name || '-' }}</div>
                        </div>
                        <div class="md:col-span-2">
                          <div class="field-label">Features Not Supported</div>
                          <div class="field-value">
                            {{ model.features_not_supported && model.features_not_supported.length > 0 ? model.features_not_supported.join(', ') : '-' }}
                          </div>
                        </div>
                      </div>
                    }
                  </div>
                </td>
                @if (writable()) {
                  <td class="px-4">
                    <div class="flex flex-col gap-2 whitespace-nowrap">
                      <button class="btn btn-sm btn-secondary" (click)="showJson(model)">
                        Json
                      </button>
                      <button class="btn btn-sm btn-primary" (click)="editModel(model.name)">
                        Edit
                      </button>
                      <button class="btn btn-sm btn-danger" (click)="confirmDelete(model.name)">
                        Delete
                      </button>
                    </div>
                  </td>
                }
              </tr>
            }
          </tbody>
        }
      </table>
    </div>
  }
</div>

<!-- Delete Confirmation Modal -->
@if (modelToDelete()) {
  <div
    class="modal-overlay"
    tabindex="0"
    (click)="cancelDelete()"
    (keydown)="($event.key === 'Enter' || $event.key === ' ') && cancelDelete()"
    aria-label="Close modal"
  >
    <div
      class="modal-dialog"
      tabindex="0"
      (click)="$event.stopPropagation()"
      (keydown)="($event.key === 'Enter' || $event.key === ' ') && $event.stopPropagation()"
      aria-modal="true"
      role="dialog"
    >
      <h2 class="modal-title">Confirm Delete</h2>
      <div class="modal-content space-y-3">
        <p>
          Are you sure you want to delete <strong>{{ modelToDelete() }}</strong
          >?
        </p>
        <p class="text-danger-600 dark:text-danger-400 font-medium">
          This action cannot be undone.
        </p>
        <div>
          <label for="delete-confirm" class="form-label">Type the model name to confirm:</label>
          <input
            id="delete-confirm"
            type="text"
            class="form-input"
            placeholder="{{ modelToDelete() }}"
            [(ngModel)]="deleteConfirmationInput"
            (ngModelChange)="deleteConfirmationInput.set($event)"
            autocomplete="off"
          />
        </div>
      </div>
      <div class="modal-actions">
        <button class="btn btn-secondary" (click)="cancelDelete()">Cancel</button>
        <button
          class="btn btn-danger"
          [disabled]="!deleteAllowed()"
          (click)="deleteModel(modelToDelete()!)"
        >
          Delete
        </button>
      </div>
    </div>
  </div>
}

<!-- JSON Display Modal -->
@if (modelJsonToShow()) {
  <div
    class="modal-overlay"
    tabindex="0"
    (click)="closeJsonModal()"
    (keydown)="($event.key === 'Enter' || $event.key === ' ') && closeJsonModal()"
    aria-label="Close modal"
  >
    <div
      class="modal-dialog modal-dialog--xl"
      tabindex="0"
      (click)="$event.stopPropagation()"
      (keydown)="($event.key === 'Enter' || $event.key === ' ') && $event.stopPropagation()"
      aria-modal="true"
      role="dialog"
    >
      <h2 class="modal-title">Model JSON: {{ modelJsonToShow()!.name }}</h2>
      <div class="modal-content">
        <pre
          class="bg-gray-100 dark:bg-gray-800 p-4 rounded-lg overflow-x-auto text-sm"
        ><code>{{ getFormattedJson(modelJsonToShow()!) }}</code></pre>
      </div>
      <div class="modal-actions">
        <button class="btn btn-secondary" (click)="copyJsonToClipboard(modelJsonToShow()!)">
          Copy
        </button>
        <button class="btn btn-primary" (click)="closeJsonModal()">Close</button>
      </div>
    </div>
  </div>
}

<!-- Stat Details Modal -->
@if (statDetailsToShow()) {
  <div
    class="modal-overlay"
    tabindex="0"
    (click)="closeStatDetails()"
    (keydown)="($event.key === 'Enter' || $event.key === ' ') && closeStatDetails()"
    aria-label="Close modal"
  >
    <div
      class="modal-dialog"
      tabindex="0"
      (click)="$event.stopPropagation()"
      (keydown)="($event.key === 'Enter' || $event.key === ' ') && $event.stopPropagation()"
      aria-modal="true"
      role="dialog"
    >
      <h2 class="modal-title">{{ statDetailsToShow()!.title }}</h2>
      <div class="modal-content">
        <pre
          class="bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 p-4 rounded-lg overflow-x-auto text-sm whitespace-pre-wrap break-words"
          >{{ statDetailsToShow()!.content }}</pre
        >
      </div>
      <div class="modal-actions">
        <button class="btn btn-secondary" (click)="copyStatDetailsToClipboard()">Copy</button>
        <button class="btn btn-primary" (click)="closeStatDetails()">Close</button>
      </div>
    </div>
  </div>
}
